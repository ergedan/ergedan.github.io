<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="BIND, Joah">
    <meta name="description" content="一、DNS1、DNS概念DNS（Domain Name System，域名系统）是互联网的一项服务。它将域名和IP地址相互映射的一个分布式数据库，能够使人方便地访问互联网。
2、使用的端口（1）53/TCP  53/UDP
（2）不同协议的">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BIND | Joah</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.jpg" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">Joah</span>
                    </a>
                </div>
                

<a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Joah</div>
        <div class="logo-desc">
            
            嘿，终于等到你来了。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/ergedan/" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>fork me
            </a>
        </li>
        
    </ul>

    <div class="social-link">
    <a href="https://github.com/ergedan/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:473823554@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=473823554" class="tooltipped" data-tooltip="QQ联系我: 473823554" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/ergedan/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="fork me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>
</header>





<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        BIND
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/BIND，DNS/" target="_blank">
                                <span class="chip bg-color">BIND，DNS</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/服务/" class="post-category" target="_blank">
                                服务
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2017-11-28
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        3,739
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        15 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="一、DNS"><a href="#一、DNS" class="headerlink" title="一、DNS"></a>一、DNS</h2><h3 id="1、DNS概念"><a href="#1、DNS概念" class="headerlink" title="1、DNS概念"></a>1、DNS概念</h3><p>DNS（Domain Name System，域名系统）是互联网的一项服务。它将域名和IP地址相互映射的一个分布式数据库，能够使人方便地访问互联网。</p>
<h3 id="2、使用的端口"><a href="#2、使用的端口" class="headerlink" title="2、使用的端口"></a>2、使用的端口</h3><p>（1）53/TCP  53/UDP</p>
<p>（2）不同协议的端口作用是什么呢？</p>
<pre><code>53/UDP:提供客户端查询功能
53/TCP和53/UDP:实现dns主从复制功能
</code></pre><h3 id="3、DNS域名"><a href="#3、DNS域名" class="headerlink" title="3、DNS域名"></a>3、DNS域名</h3><p>开头我们述说DNS是分布式数据库，想必大家猜到了DNS是层级结构的。<br><img src="http://owatlfstl.bkt.clouddn.com/q.jpg" alt=""></p>
<p>从图中可以看出DNS的层级结构</p>
<p>（1）根域（Top Level Domain，tld）</p>
<p>（2）顶级域</p>
<pre><code>（a）组织域， com，org，gov，mil等
（b）国家域，cn，ca，hk，tw等
（c）反向域，arpa
</code></pre><p>（3）二级域<br>    …</p>
<h3 id="4、DNS服务器类型"><a href="#4、DNS服务器类型" class="headerlink" title="4、DNS服务器类型"></a>4、DNS服务器类型</h3><p>（1）主DNS服务器</p>
<pre><code>作用：管理和维护负责解析的域内解析库的服务器
</code></pre><p>。<br>（2）从DNS服务器</p>
<pre><code>作用：从主服务器或从服务器“复制”（区域间传输）解析库副本。

这里我们需要注意一下，区域传输分为两种
（a）完全传输（axfr）：传送整个解析库；
（b）增量传输（ixfr）：传递解析库变化的内容；
</code></pre><p>是不是大家想，主从DNS服务器时如何工作的呢？</p>
<pre><code>有两种工作机制“PUSH”和“PULL”。当主DNS服务器配置文件中序列号发生递增，重新DNS服务；主DNS服务器会主动向从DNS服务器同步信息；这个过程称为&#39;PUSH&#39;。如果区域传输终端，没有同步成功，从服务器会根据配置文件中的”retry“指定的时间重新尝试同步信息，这个过程称为“PULL”。
</code></pre><h3 id="5、DNS解析"><a href="#5、DNS解析" class="headerlink" title="5、DNS解析"></a>5、DNS解析</h3><p>DNS解析分为两种</p>
<pre><code>（a）正向解析：FQDN--&gt;IP
（b）反向解析:  IP--&gt;FQDN
</code></pre><p><strong>注意：正向解析是两个不同的名称空间，是两个不同的解析树，如果为子域则写DNS服务IP。</strong></p>
<p>DNS查询类型：</p>
<pre><code>（a）递归查询
（b）迭代查询
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-19_214603.png" alt=""></p>
<p>一次完整的DNS查询请求的过程：Client–&gt;host文件–&gt;DNS server Local Cache –&gt;DNS server（recursion）–&gt;Server Cache–&gt;Iteration（迭代）–&gt;Root–&gt;TLD–&gt;二级域名–&gt;…</p>
<h3 id="6、DNS资源类型"><a href="#6、DNS资源类型" class="headerlink" title="6、DNS资源类型"></a>6、DNS资源类型</h3><p>区域解析库由众多的RR（resource record）组成。存在不同的类型：A,AAAA,SOA,CNAME,MX,PTR,NS。</p>
<p>资源记录的格式：</p>
<pre><code>NAME    [TTL]    IN     RR_TYPE     VALUE
</code></pre><p>下面有几点需要注意的：</p>
<p>（a）$TTL变量，全局继承此处的缓存周期，默认单位为秒。</p>
<p>（b）@代替<code>/etc/named.rfc1912.zones</code>配置的ZONE_NAME.</p>
<p>（c）同一个名字可以通过多条记录定义多个不同的值，此时DNS服务器会以轮询方式进行相应。</p>
<p>（d）同一个值可能有多个不同定义的名字；通过多个不同的名字指向同一个值进行定义。此仅表示通过多个不同的名字可以找到同一个主机。</p>
<h4 id="（1）SOA：Start-Of-Authority，起始授权记录。"><a href="#（1）SOA：Start-Of-Authority，起始授权记录。" class="headerlink" title="（1）SOA：Start Of Authority，起始授权记录。"></a>（1）SOA：Start Of Authority，起始授权记录。</h4><p>value的构成：</p>
<p>（a）当前区域的主DNS服务器的   FQDN，也可以使用<code>/etc/named.rfc1912.zones</code>配置的ZONE_NAME。</p>
<p>（b）当前区域管理员的邮箱地址，但地址中不能使用”@“，一般使用“.”替代。因为在配置文件中“@”表示特殊含义<br>。</p>
<p>（c）主从服务区域传输相关定义以及否定的答案的同一TTL。</p>
<pre><code>@       IN SOA  @ rname.invalid. (
                                    0       ; serial    #解析库序列号，主服务器解析库变化时，递增，最长只能为十位数组成，一般为了方便管理这样管理“当前日期+版本号”
                                    1D      ; refresh   #刷新时间，从服务器从主服务器请求同步解析库的时间
                                    1H      ; retry     #重试时间，从服务器从主DNS服务器请求失败时，再次尝试的时间
                                    1W      ; expire    #过期时长，从服务器联系不到主服务器时，多久后停止服务
                                    3H )    ; minimum   #错误解析存活时长
</code></pre><p><strong>注意：一个区域解析库只能有且仅有一个SOA记录，必须位于解析库的第一条记录。</strong></p>
<h4 id="（2）NS，Name-Server-，名称服务"><a href="#（2）NS，Name-Server-，名称服务" class="headerlink" title="（2）NS，Name Server ，名称服务"></a>（2）NS，Name Server ，名称服务</h4><p>value：当前区域的某DNS服务器名称</p>
<p><strong>注意：</strong></p>
<p>（a）相邻的两个资源记录的NAME相同时，后续可省略。</p>
<p>（b）任何一个NS记录后面的服务器名字，都应该在后续有一个A记录。</p>
<h4 id="（3）MX，Mail-eXchange，邮件转换"><a href="#（3）MX，Mail-eXchange，邮件转换" class="headerlink" title="（3）MX，Mail eXchange，邮件转换"></a>（3）MX，Mail eXchange，邮件转换</h4><p>value：当前区域的某邮件服务器的主机名</p>
<p><strong>注意：</strong></p>
<p>（1）在一个区域内可以有多个MX记录,但是每个MX记录前应该有一个数字（0-99），表示服务器的优先级，数字越小优先级越高。</p>
<p>（2）任何一个MX记录后应该有一个A记录。</p>
<h4 id="（4）A-记录"><a href="#（4）A-记录" class="headerlink" title="（4）A 记录"></a>（4）A 记录</h4><p>value：主机名对应的IP地址</p>
<p>对于A记录有以下几种定义格式:</p>
<p>(a)可以使用FQDN</p>
<p>(b)可以使用泛域名 *.ZONE_NAME,这种方式的好处是避免用户写错名称时给错误答案，将错误答案指向某特性的地址。</p>
<p>(c)如果一个网段中地址不确定可以是使用 $GGENERATE #-# NAME$       后面对应的地址也是，网段加$</p>
<pre><code>示例：$GENERATE 100-150 host$     IN    A  192.168.4.$
</code></pre><h4 id="5-AAAA记录"><a href="#5-AAAA记录" class="headerlink" title="(5)AAAA记录"></a>(5)AAAA记录</h4><h4 id="6-PTR-PoinTeR-IP，反向域名解析"><a href="#6-PTR-PoinTeR-IP，反向域名解析" class="headerlink" title="(6)PTR PoinTeR  IP，反向域名解析"></a>(6)PTR PoinTeR  IP，反向域名解析</h4><pre><code>格式：IP   PTR     FQDN
完整格式：135.4.168.192-in.adder.arpa    IN PTR dns1
如果192.168.4为网络地址，可以这样写 135  IN PTR DNS1
</code></pre><p><strong>注意:主机地址要反着写。</strong></p>
<h4 id="（7）CNAME-别名"><a href="#（7）CNAME-别名" class="headerlink" title="（7）CNAME 别名"></a>（7）CNAME 别名</h4><p>有时候我们访问一个网站是www主机不一定是真正的主机。有可能使用了这种别名机制</p>
<pre><code>示例： www IN CNAME    websrv
</code></pre><p>我们在访问一个网址时，有可能为如下地址<code>www.test.server.com</code>对整个地址来说真正的，test为server的子域。server为com的子域。n那么父域如何对子域进行授权呢？</p>
<p>子域授权：每个域的名称服务器，都是通过父域服务器在解析库进行授权。</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-19_193850.png" alt=""></p>
<p>如图所述：想必大家多DNS的名称，过程有了一定的了解，下面通过看上面这张图，可以看出子域与父域的管理。通过观察图中，一个zone可有多个RR组成。可以粗略的看出DNS的容错功能，实现负载的作用。父域通过委派子域进行管理。</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-19_194012.png" alt=""></p>
<p>如图所示：DNS是工作在内核中的，用户是没有办法直接管理DNS服务，那要如何管理DNS服务呢？前人想出了Bind进行管理DNS服务。这样用户通过用户空间借助于Bind管理工具或配置文件就可以管理DNS服务了。</p>
<h2 id="二、编译安装bind"><a href="#二、编译安装bind" class="headerlink" title="二、编译安装bind"></a>二、编译安装bind</h2><blockquote>
<p>（1）下载源码包</p>
</blockquote>
<p><a href="https://www.isc.org/downloads/" target="_blank" rel="noopener">https://www.isc.org/downloads/</a></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_110742.png" alt=""></p>
<blockquote>
<p>（2）解压缩源码包</p>
</blockquote>
<pre><code>[root@localhost~]#mv bind-9.10.6.tar.gz /usr/src/
[root@localhost~]#cd /usr/src/
[root@localhost/usr/src]#tar xvf bind-9.10.6.tar.gz 
</code></pre><blockquote>
<p>（3）来我们先看看bind包原来有没有安装脚本呢？</p>
</blockquote>
<pre><code>[root@localhost ~]# rpm -q --scripts bind
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_094626.png" alt=""><br>从图中我们可以看出，安装前需要自己创建用户，那么我们来创建一个用户吧</p>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#useradd -r -d /var/named -s /sbin/nologin -m named #这里由于是系统用户，如果不加“-m”的话，是不能创建家目录的，切记！！！
</code></pre><blockquote>
<p>（4）我们接下来看看如何安装bind</p>
</blockquote>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#cat README
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_093021.png" alt=""></p>
<p>如果直接向定制bind程序，显然这样做是不能满足我们的需求的，我们可以使用如下操作定制我们bind程序</p>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#./configure --help
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_093256.png" alt=""><br>如上图所示，这里只是截取部分图，这里可以选择我们要安装的包位置，启用或关闭某些功能，实现定制bind，相信很多第一次编译的像我这样的人来说认真研究一种程序源码安装过程，基本可以掌握别的源码包的安装。</p>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#./configure --prefix=/app/bind10 --sysconfdir=/etc/bind10 
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_093607.png" alt=""></p>
<p>来来看看，我说什么了，当出现这是不是不知道如何操作，没有人家说的很清楚了，没有gcc，那该如何解决呢？那么我们来安装一个开发包来解决这个问题</p>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#yum groupinstall -y &quot;development tools&quot;
</code></pre><p>那我们再来尝试一次，看看这次会出现什么幺蛾子。</p>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#./configure --prefix=/app/bind10 --sysconfdir=/etc/bind10 
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_094017.png" alt=""></p>
<p>看看我说什么来着，这次又出错啦，为什么呢？它提示我们说没有openssl程序，如果想依赖这个程序，可以安装openssl-devel；一般源码包遇到的情况，都安装相对的开发包即可。</p>
<p>那我们再来测试一次，看看还会出现什么情况呢？</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_094342.png" alt=""></p>
<p>当当当，哈哈，竟然成功啦   ；不过这只是成功了一部分，如果想继续成功那就实行下面步骤吧</p>
<blockquote>
<p>（5）进行编译安装</p>
</blockquote>
<pre><code>[root@localhost/usr/src/bind-9.10.6]#make ;make install  
make 的作用是开始进行源代码编译，以及一些功能的提供，这些功能由他的 Makefile 设置文件提供相关的功能； make install 一般表示进行安装，相当于创建软连接，创建目录等等一些操作。
</code></pre><blockquote>
<p>（6）这样安装的话是没有命令PATH和man帮助的，那如何实现呢？</p>
</blockquote>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_100032.png" alt=""></p>
<pre><code>[root@localhost~]#vim /etc/profile.d/env.sh
[root@localhost~]#source !$
source /etc/profile.d/env.sh
</code></pre><p>export PATH=/app/bind10/bin:/app/bind10/sbin:$PATH</p>
<pre><code>[root@localhost~]#vim /etc/man_db.conf
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_101009.png" alt=""></p>
<blockquote>
<p>（7）刚刚在（2）比步骤是不是看看还有安装后脚本呀，对的你没有看错，那么我们来进行安装后脚本需要的操作。安装后脚本需要我们使用命令rndc-confgen创建相当于”暗号“，创建了暗号才能访问，那么我们就看看如何创建暗号呢？</p>
</blockquote>
<pre><code>[root@localhost~]#rndc-confgen -r /dev/urandom &gt; /etc/bind10/rndc.conf  #如果不重定向只能在终端上显示，写不到文件中
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_101550.png" alt=""></p>
<p>不过我们现在还没有主配置文件named.conf文件，怎么办呢？那就手动创建一个喽</p>
<pre><code>[root@localhost~]#vim /etc/bind10/named.conf
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_101931.png" alt=""><br>不过刚刚我们了解到bind程序运行者是named用户，但是我们来看看这个文件所有者和所属组是who</p>
<pre><code>[root@localhost~]#ll /etc/bind10/named.conf 
-rw-r--r--. 1 root root 200 Sep 22 10:19 /etc/bind10/named.conf
[root@localhost~]#chgrp named /etc/bind10/named.conf    #修改所属组
[root@localhost/etc/bind10]#chgrp named bind10/ -R  #修改文件都为named所属组
</code></pre><blockquote>
<p>（8）不过DNS中解析当然需要根啦那么我们就创建一个喽</p>
</blockquote>
<pre><code>[root@localhost named]# scp named.ca 192.168.4.152:/var/named/  #从远程主机上拷贝一个
[root@localhost/var]#chgrp named named/ -R  #修改权限
</code></pre><p><code>[root@localhost~]#vim /etc/bind10/named.conf</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_103158.png" alt=""></p>
<pre><code>[root@localhost/var/named]#vim test.com.zone    #编辑测试域
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_103607.png" alt=""></p>
<pre><code>[root@localhost/var/named]#chgrp named test.com.zone    #修改权限
</code></pre><blockquote>
<p>（9）那我们接下来尝试着看看能不能起来服务</p>
</blockquote>
<pre><code>[root@localhost~]#named -u named -g -f -d 3
[root@localhost~]#ss -tnul
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_104322.png" alt=""></p>
<p>端口53/tcp 53/udp 953/tcp 已经处于监听状态，说明启动已经成功</p>
<blockquote>
<p>（10）我们尝试看看可以解析么？</p>
</blockquote>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-22_110558.png" alt=""></p>
<p>那么接下来测测我们dns的性能如何喽</p>
<blockquote>
<p>对压力测试工具编译安装</p>
</blockquote>
<pre><code>[root@localhost ~]# cd /usr/src/bind-9.10.6/contrib/queryperf   #切换至源码包位置
[root@localhost/usr/src/bind-9.10.6/contrib/queryperf]#./configure #进行编译
[root@localhost/usr/src/bind-9.10.6/contrib/queryperf]#make
[root@localhost/usr/src/bind-9.10.6/contrib/queryperf]#cp queryperf /app/bind10/bin/    #将程序复制到bind执行程序的目录下
</code></pre><blockquote>
<p>创建一个测试文本</p>
</blockquote>
<pre><code>[root@localhost~]#vim test
</code></pre><blockquote>
<p>测试</p>
</blockquote>
<pre><code>[root@localhost~]#queryperf -d test -s 127.0.0.1
</code></pre><h2 id="三、实现管理DNS"><a href="#三、实现管理DNS" class="headerlink" title="三、实现管理DNS"></a>三、实现管理DNS</h2><h3 id="1、bind安装包"><a href="#1、bind安装包" class="headerlink" title="1、bind安装包"></a>1、bind安装包</h3><pre><code>bind-libs.x86_64             #库包           
bind-libs-lite.x86_64       #     
bind-license.noarch        #认证包
bind-utils.x86_64            #提供对dns服务器的测试工具程序
bind-chroot                     #为bind提供一个伪装的根目录以增强安全性
</code></pre><h3 id="2、Bind配置文件"><a href="#2、Bind配置文件" class="headerlink" title="2、Bind配置文件"></a>2、Bind配置文件</h3><p>服务脚本    <code>/etc/rc.d/init.d/named</code>和<code>/usr/lib/systemcd/system/named.service</code></p>
<p>主配置文件<code>/etc/named.conf</code> <code>/etc/named/rfc1912.zones</code></p>
<p>存放根服务器地址 <code>/var/named/name.ca</code></p>
<p>解析库文件 <code>/var/named/ZONE_NAME_ZONE</code></p>
<p><strong>注意：</strong></p>
<p>（1）一台物理服务器可同时为多个区域提供解析。</p>
<p>（2）必须要有根文件：name.ca。</p>
<p>（3）应该有两个实现localhost和本地回环的解析库。</p>
<p>主配置文件<code>/etc/namd.conf</code></p>
<pre><code>// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.  #这个文件是一个参考例子
//
// See the BIND Administrator&#39;s Reference Manual (ARM) for details about the
// configuration located in /usr/share/doc/bind-{version}/Bv9ARM.html

options {                                       #全局设置
        listen-on port 53 { 127.0.0.1; };   #IPv4监听的端口和IP地址
        listen-on-v6 port 53 { ::1; };         #IPv6监听的端口
        directory       &quot;/var/named&quot;;       #zone配置文件存放目录
        dump-file       &quot;/var/named/data/cache_dump.db&quot;;    #下载缓存数据库
        statistics-file &quot;/var/named/data/named_stats.txt&quot;;      #静态文件
        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
        allow-query     { localhost; };     #允许询问

        /* 
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable 
           recursion. 
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification 
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface 
        */
        recursion yes;  #是否递归查询

        dnssec-enable yes;      #是否支持DNSSEC开关
        dnssec-validation yes;  #是否进行DNSSEC确认开关

        /* Path to ISC DLV key */
        bindkeys-file &quot;/etc/named.iscdlv.key&quot;;

        managed-keys-directory &quot;/var/named/dynamic&quot;;

        pid-file &quot;/run/named/named.pid&quot;;
        session-keyfile &quot;/run/named/session.key&quot;;
};

logging {                           #日志信息
        channel default_debug {
                file &quot;data/named.run&quot;;  #存放的文件位置
                severity dynamic;       #工作模式
        };
};

zone &quot;.&quot; IN {                       #根域
        type hint;                      #zone类型
        file &quot;named.ca&quot;;            #文件名称
};

include &quot;/etc/named.rfc1912.zones&quot;; 
include &quot;/etc/named.root.key&quot;;
</code></pre><p><strong>建议一般不要在这个文件中配置zone，可以在<code>/etc/named.rfc1912.zones</code>文件下进行配置。</strong></p>
<p><code>/var/named/named.localhost</code>   文件</p>
<pre><code>$TTL 1D
@    IN SOA    @ rname.invalid. (
                    0    ; serial
                    1D    ; refresh
                    1H    ; retry
                    1W    ; expire
                    3H )    ; minimum
    NS    @
    A    127.0.0.1
    AAAA    ::1
</code></pre><p>一般这个文件作为一个模板文件进行zone的配置。</p>
<h3 id="3、DNS转发服务器"><a href="#3、DNS转发服务器" class="headerlink" title="3、DNS转发服务器"></a>3、DNS转发服务器</h3><p> （1）全局转发：对非本机所负责区域的请求，全转发给指定的服务器。</p>
<pre><code>options{
    forward  first|only；
    forwarders { IP; };
}；
</code></pre><p>（2）特定区域转发：仅转发对特定区域的请求，比全局转发优先级高。</p>
<pre><code>zone &quot;ZONE_NAME&quot; IN {
    tyep    forward;
    forward first|only;
    forwarders { IP; }
};
</code></pre><h3 id="4、从DNS服务器"><a href="#4、从DNS服务器" class="headerlink" title="4、从DNS服务器"></a>4、从DNS服务器</h3><p>（1）应该为一台独立的名称服务器</p>
<p>（2）主服务器区域解析文件中必须有一条NS记录指向从DNS服务器</p>
<p>（3）从服务器只需要定义区域，而无须提供解析库；解析库文件应该放置于<code>/var/named/slaves</code>目录下。</p>
<p>（4）主服务器得允许从服务器区域传送</p>
<p>（5）主从服务器的时间应该保持一致</p>
<p>（6）Bind程序版本应该保持一致；如果不一致，建议主服务器低，从服务器高。</p>
<p>（7）修改网卡配置文件<code>/etc/sysconfig/network-scripts-ifcfg-INTERFACE</code>,添加DNS记录。</p>
<h3 id="5、允许动态更新"><a href="#5、允许动态更新" class="headerlink" title="5、允许动态更新"></a>5、允许动态更新</h3><p>如果想启用此功能，可以在<code>/etc/named.rfc1912.zones</code>文件中定义之。</p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="www.lmfe.org" class="b-link-green">Joah</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2017/11/28/BIND/" class="b-link-green">BIND</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2017/11/28/ansible模块/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="ansible常用模块">
                        
                        <span class="card-title">ansible常用模块</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">常用模块介绍ansible中执行命令时，必须考虑其幂等性；即返回的结果不是错误的。如果一个文件存在则不再创建等等情况。
（1）command模块：在远程节点执行命令，此模块为默认模块



action
说明




chdir
执行命令切</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2017-11-28
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/自动化/" class="post-category" target="_blank">
                                    自动化
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ansible/" target="_blank">
                        <span class="chip bg-color">ansible</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2017/11/28/iptables/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="iptables">
                        
                        <span class="card-title">iptables</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">一、iptables1、iptables历史iptables的前身叫ipfirewall （内核1.x时代）,这是一个作者从freeBSD上移植过来的，能够工作在内核当中的，对数据包进行检测的一款简易访问控制工具。但是ipfirewall工</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2017-11-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/防火墙/" class="post-category" target="_blank">
                                    防火墙
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/iptables/" target="_blank">
                        <span class="chip bg-color">iptables</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">180.3k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ergedan/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:473823554@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=473823554" class="tooltipped" data-tooltip="QQ联系我: 473823554" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input" autofocus="">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->




    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>