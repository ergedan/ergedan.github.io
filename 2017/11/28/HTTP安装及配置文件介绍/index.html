<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="HTTP配置, Joah">
    <meta name="description" content="Http安装及文件介绍1、文件类型
主配置文件
  /etc/httpd/conf/httpd.conf  /etc/httpd/conf.d/*.conf

服务脚本文件
  /etc/rc.d/init.d/httpd  /etc/sy">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>HTTP配置 | Joah</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.jpg" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">Joah</span>
                    </a>
                </div>
                

<a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Joah</div>
        <div class="logo-desc">
            
            嘿，终于等到你来了。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/ergedan/" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>fork me
            </a>
        </li>
        
    </ul>

    <div class="social-link">
    <a href="https://github.com/ergedan/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:473823554@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=473823554" class="tooltipped" data-tooltip="QQ联系我: 473823554" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/ergedan/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="fork me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>
</header>





<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        HTTP配置
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/HTTP，Apache/" target="_blank">
                                <span class="chip bg-color">HTTP，Apache</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/常用服务/" class="post-category" target="_blank">
                                常用服务
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2017-11-28
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        5,902
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        27 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Http安装及文件介绍"><a href="#Http安装及文件介绍" class="headerlink" title="Http安装及文件介绍"></a>Http安装及文件介绍</h2><h3 id="1、文件类型"><a href="#1、文件类型" class="headerlink" title="1、文件类型"></a>1、文件类型</h3><ul>
<li><p>主配置文件</p>
<p>  /etc/httpd/conf/httpd.conf<br>  /etc/httpd/conf.d/*.conf</p>
</li>
<li><p>服务脚本文件</p>
<p>  /etc/rc.d/init.d/httpd<br>  /etc/sysconfig/httpd    #脚本配置文件</p>
</li>
<li><p>站点网页文档默认目录</p>
<p>  /var/www/html</p>
</li>
<li><p>模块文件路径</p>
<p>  /etc/httpd/modules<br>  /usr/lib64/httpd/modules</p>
</li>
<li><p>主程序文件</p>
<p>  /usr/sbin/httpd<br>  /usr/sbin/httpd.worker<br>  /usr/sbin/httpd.event</p>
</li>
<li><p>主进程文件</p>
<p>  /etc/httpd/run /httpd.pid   #如果这个文件之前存在，系统重启之后会覆盖此配置文件。如果没有会自动创建之。</p>
</li>
<li><p>日志文件目录</p>
<p>  /var/log/httpd/access_log<br>  /var/log/httpd/err_log</p>
</li>
<li><p>帮助文档包</p>
<p>  httpd-manual    #如果需要使用可以安装，访问示例<code>http:192.168.4.135/manual</code></p>
</li>
</ul>
<h3 id="2、-etc-httpd-conf-httpd-conf文件选项介绍"><a href="#2、-etc-httpd-conf-httpd-conf文件选项介绍" class="headerlink" title="2、/etc/httpd/conf/httpd.conf文件选项介绍"></a>2、<code>/etc/httpd/conf/httpd.conf</code>文件选项介绍</h3><ul>
<li>httpd.conf文件的主要分类</li>
</ul>
<p><code>[root@localhost ~]# grep &#39;###&#39; /etc/httpd/conf/httpd.conf</code></p>
<pre><code>### Section 1: Global Environment   #全局配置
### Section 2: &#39;Main&#39; server configuration  #主机配置
### Section 3: Virtual Hosts    #虚拟主机配置
</code></pre><ul>
<li>选项介绍</li>
</ul>
<p>（1）ServerTokens 显示服务器版本信息</p>
<p>syntax：ServerTokens Major|Minor|Min[imal]|Prod[uctOnly]|OS|Full</p>
<pre><code>ServerTokens Prod[uctOnly]  #仅显示类型  
Server sends (e.g.): Server: Apache
ServerTokens Major  #显示版本及主版本号
Server sends (e.g.): Server: Apache/2
ServerTokens Minor  #显示类型主板本号及此版本号
Server sends (e.g.): Server: Apache/2.0
ServerTokens Min[imal]
Server sends (e.g.): Server: Apache/2.0.41
ServerTokens OS #显示类型版本号及系统类型
Server sends (e.g.): Server: Apache/2.0.41 (Unix)
ServerTokens Full (or not specified)    #全部显示  #系统默认#
Server sends (e.g.): Server: Apache/2.0.41 (Unix) PHP/4.2.2 MyMod/1.2   
</code></pre><p><em>建议使用ServerTokens prod，防止此版本有漏洞被入侵。建议一般不要显示版本号。</em></p>
<p>（2）Listen 修改监听的IP和Port</p>
<p>Syntax:    Listen [IP-address:]portnumber [protocol]</p>
<ul>
<li>省略IP 表示为0.0.0.0</li>
<li>Listen指令至少一个，可重复出现多次</li>
<li>修改监听socket，重启或重新加载服务进程方可生效</li>
</ul>
<p>示例：</p>
<pre><code>Listen 80
Listen 8080
Listen 192.168.4.150:80
</code></pre><p>（3）持久连接<br>建立连接，每个资源获取完成后不断开连接，而好似继续等待其他的请求完成，默认关闭</p>
<blockquote>
<p>KeepAlive</p>
</blockquote>
<p>Syntax:    KeepAlive On|Off    #默认为关闭</p>
<blockquote>
<p>MaxKeepAliveRequests </p>
</blockquote>
<p>Synatax:MaxKeepAliveRequests number     #默认最大连接请求100</p>
<blockquote>
<p>KeepAliveTimeout</p>
</blockquote>
<p>Syntax：KeepAliveTimeout  seconds    #默认持久连接超时时间为5秒</p>
<p>缺点：对并发量较大的服务器，持久连接功能会使其它有些请求得不到回应。</p>
<p>解决方法：使用较短的持久时间设置。</p>
<p>（4）MPM（Multi-Processing Module） 多进程处理模块</p>
<p>MPM的类型在前面已经详细的介绍，这里来说说在配置文件中怎么配置</p>
<blockquote>
<p>prefork配置</p>
</blockquote>
<pre><code>&lt;IfModule prefork.c&gt;
StartServer number  #初始化开启几个进程
MinSpareServers number  #最小空闲进程
MaxSpareServers number  #最大空闲进程
ServerLimit number  #最大开启的进程数 ，最大为20000个
MaxClients number   #最大并发量
MaxRequestsPerChild number  #最多处理的请求数量  默认为10000。在子进程请求之后，子进程会被父进程终止，子进程占用的内容就会释放（为0是永远释放）。
&lt;/IfModule&gt;
</code></pre><blockquote>
<p>worker配置</p>
</blockquote>
<pre><code>&lt;IfModule worker.c&gt;
StartServers number  #初始化开启几个进程
MaxClients number   #最大并发量
MinSpareThreads number  #最小空闲线程
MaxSpareThreads number  #最大空闲进程
ThreadsPerChild number  #一个子进程最多开启几个线程
MaxRequestsPerChild number #一个子进程最多有多个访问请求 默认10000
&lt;/IfModule&gt;
</code></pre><p>配置文件默认内容</p>
<pre><code>&lt;IfModule worker.c&gt;
    StartServers 4 
    MaxClients 300 
    MinSpareThreads 25 
    MaxSpareThreads 75
    ThreadsPerChild25
    MaxRequestsPerChild 0 
 &lt;/IfModule&gt;  
</code></pre><p>这里需要注意: <code>StartServers</code>*<code>ThreadsPerChild</code>&gt;<code>MaxSpareThreads</code> 所以系统初始时会少开一个进程。</p>
<p>如何更改工作模式呢？</p>
<p><code>[root@localhost ~]# vim /etc/sysconfig/httpd</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_114451.jpg" alt=""></p>
<p>如何计算PV的值呢？</p>
<p>假设每秒中开启256进程，持久连接，每个进程能处理5个资源；每个网页有100个资源，如何计算PV？</p>
<p>pv：256<em>5</em>86400/100=1105920</p>
<p>带宽1024<em>5</em>256/1024/1024*8=8M 网络中计算是以位为单位</p>
<p>（5）DSO：Dynamic Shared Object 动态加载模块</p>
<pre><code>httpd -M #查看动态加载模块
httpd -l  #查看静态加载模块
</code></pre><p>格式：</p>
<pre><code>LoadModule   &lt;mod_name&gt;   &lt;mod_path&gt;
</code></pre><p>mod_path写路径时要写相对路径：相对于<code>ServerRoot</code></p>
<p>（6）DocumentRoot 定义Main server 中文档页面路径</p>
<p>Syntax:    DocumentRoot directory-path </p>
<p>文档路径映射：DocumentRoot指向的路径为URL路径的起始位置。</p>
<p><strong>示例：</strong></p>
<pre><code>http://HOST:PORT/test/index.html
                              \|/             
                     /app/data/test/index.html 
</code></pre><p>（7）DirectoryIndex 定义站点页面</p>
<p>Syntax:    DirectoryIndex local-url [local-url] …</p>
<p><code>/etc/httpd/conf.d/welcome.conf</code>如果主站点出错可以跳转至此页面</p>
<p>（8）站点访问控制常见机制</p>
<p>可基于两种机制指明对哪些资源进行何种访问控制</p>
<blockquote>
<p>文件系统路径：</p>
</blockquote>
<pre><code>&lt;directory &quot;/PATH&quot;&gt;
    ...

&lt;/directory&gt;

&lt;File &quot;/PATH/FILE&quot;&gt;
    ...
&lt;/File&gt;

&lt;FileMatch&gt;
    ...
&lt;/FileMatch&gt;
</code></pre><blockquote>
<p>URL路径：</p>
</blockquote>
<pre><code>&lt;Location URL-path|URL&gt;
    ...
&lt;/Location&gt;

&lt;LocationMatch regex&gt;
    ...
&lt;/LocationMatch&gt;
</code></pre><p>其上的路径都可以使用正则表达式和通配符</p>
<table>
<thead>
<tr>
<th>通配符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>匹配任意长度字符</td>
</tr>
<tr>
<td>?</td>
<td>匹配任意单个字符</td>
</tr>
<tr>
<td>[]</td>
<td>匹配中括号内的任意单个字符</td>
</tr>
<tr>
<td>[^]</td>
<td>除中括号里的都匹配</td>
</tr>
</tbody>
</table>
<p>正则表达式：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>匹配任意单个字符</td>
</tr>
<tr>
<td>*</td>
<td>匹配前一个字符任意长度，0次或多次</td>
</tr>
<tr>
<td>？</td>
<td>匹配前一个字符一次或0次</td>
</tr>
<tr>
<td>+</td>
<td>匹配前一个字符一次或多次</td>
</tr>
<tr>
<td>[]</td>
<td>匹配括号里的任意单个字符</td>
</tr>
</tbody>
</table>
<p>…</p>
<p><strong>示例：</strong></p>
<pre><code>&lt;FilesMatch &quot;\.(gif|jpe?g|png)$&quot;&gt;
&lt;Files “?at.*”&gt; 
&lt;Location /status&gt;
 &lt;LocationMatch &quot;/(extra|special)/data&quot;&gt;
</code></pre><p><strong>注意：使用正则表达式比较耗费资源，会遍历整个路径去寻找，建议不要使用。</strong></p>
<p>（9）<directory>中“基于源地址”实现访问控制</directory></p>
<ul>
<li>Options</li>
</ul>
<p>Syntax:    Options [+|-]option [[+|-]option] …</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Indexes</td>
<td>指明的URL路径下不存在于定义的主页面资源相符的资源文件时，返回索引列表给用户</td>
</tr>
<tr>
<td>FollowSymlinks</td>
<td>允许访问符号链接文件所指向的源文件，默认支持软连接。</td>
</tr>
<tr>
<td>None</td>
<td>全部禁用</td>
</tr>
<tr>
<td>All</td>
<td>全部允许，系统默认选项</td>
</tr>
<tr>
<td>MultiViews</td>
<td>允许使用多视图</td>
</tr>
</tbody>
</table>
<p><strong>注意：Options只对<direcotry>有效。</direcotry></strong></p>
<p><strong>示例：</strong></p>
<p>（1）在<code>/etc/httpd/conf.d/</code>目录下创建custom.conf文件</p>
<p><code>[root@localhost conf.d]# vim custom.conf</code></p>
<pre><code>&lt;Directory &quot;/app/testweb&quot;&gt;
Options None    #全部禁用
&lt;/Directory&gt;
</code></pre><p>（2）把welcome.conf文件删除或修改名字</p>
<p><code>[root@localhost conf.d]# mv welcome.conf welcome.conf.bak</code></p>
<p>（3）重启服务测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160342.jpg" alt=""></p>
<p>现在我们再修改配置文件修改为<code>Options Indexes</code></p>
<pre><code>&lt;Directory &quot;/app/testweb&quot;&gt;
     Options Indexes
&lt;/Directory&gt;
</code></pre><p>重启服务测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160628.jpg" alt=""></p>
<ul>
<li>AllowOverride </li>
</ul>
<p>与访问控制相关的的指令可以放在指定目录下.htaccess文件中，覆盖之前配置指令。</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AuthConfig</td>
<td>允许使用与认证授权相关的指令</td>
</tr>
<tr>
<td>FileInfo</td>
<td>允许使用控制文档类型的指令</td>
</tr>
<tr>
<td>Indexes</td>
<td>允许使用控制目录索引的指令</td>
</tr>
<tr>
<td>Limit</td>
<td>允许使用控制主机访问的指令</td>
</tr>
<tr>
<td>Options[=Option,…]</td>
<td>允许使用控制指定目录功能的指令</td>
</tr>
<tr>
<td>None</td>
<td>.htaccess文件失效</td>
</tr>
</tbody>
</table>
<p><strong>示例:</strong></p>
<p>在上面的基础上我们再<code>/app/testweb.htaccess</code>此文件</p>
<p><code>[root@localhost testweb]# vim .htaccess</code></p>
<pre><code>Options Indexes
</code></pre><p>在<code>custom.conf</code>编辑</p>
<p><code>[root@localhost conf.d]# vim custom.conf</code></p>
<pre><code>&lt;Directory &quot;/app/testweb&quot;&gt;
Options None
AllowOverride All
&lt;/Directory&gt;
</code></pre><p>由于我们在上面测试的时候如果Options为None时候网页出现如下情况</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160342.jpg" alt=""></p>
<p>先我们再测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160628.jpg" alt=""></p>
<p>这时你会不会想到放到站点目录下会不会被访问到呢？这样显然就不安全了，开发人员已经想到了这点如下：</p>
<pre><code>&lt;Files ~ &quot;^\.ht&quot;&gt;
    Order allow,deny
    Deny from all
    Satisfy All
&lt;/Files&gt;
</code></pre><p>现在我们真正了解了<code>AllowOverride</code>选项作用了。使用这种方法我们控制一些内容。</p>
<ul>
<li>Order 和allow 、deny</li>
</ul>
<p>定义生效次序；写在后面的表示默认规则，优先级高。</p>
<table>
<thead>
<tr>
<th>匹配次序</th>
<th>条件</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>Match</td>
<td>Allow,Deny result</td>
<td>Deny,Allow result</td>
</tr>
<tr>
<td>Match Allow only</td>
<td>Request allowed</td>
<td>Request allowed</td>
</tr>
<tr>
<td>Match Deny only</td>
<td>Request denied</td>
<td>Request denied</td>
</tr>
<tr>
<td>No match</td>
<td>Default to second directive: Denied</td>
<td>Default to second directive: Allowed</td>
</tr>
<tr>
<td>Match both Allow &amp; Deny</td>
<td>Final match controls: Denied</td>
<td>Final match controls: Allowed</td>
</tr>
</tbody>
</table>
<blockquote>
<p>格式：</p>
</blockquote>
<p>A (partial) domain-name</p>
<p>Example:</p>
<pre><code>Allow from apache.org
deny from .net example.edu
</code></pre><p>A full IP address</p>
<p>Example:</p>
<pre><code>Allow from 10.1.2.3
deny from 192.168.1.104 192.168.1.205
</code></pre><p>A partial IP address</p>
<p>Example:</p>
<pre><code>Allow from 10.1
deny from 10 172.20 192.168.2
</code></pre><p>A network/netmask pair</p>
<p>Example:</p>
<pre><code>Allow from 10.1.0.0/255.255.0.0
deny from 20.1.0.0/255.255.0.0
</code></pre><p>A network/nnn CIDR specification</p>
<p>Example:</p>
<pre><code>Allow from 10.1.0.0/16
deny from 20.1.0.0/16
</code></pre><blockquote>
<p>示例</p>
</blockquote>
<p>编辑<code>custom.conf</code>文件</p>
<pre><code>&lt;Directory &quot;/app/testweb&quot;&gt;
    Options Indexes
    Order allow,deny
    Deny from 192.168
&lt;/Directory&gt;
</code></pre><p>重启服务测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160342.jpg" alt=""></p>
<p>如果修改为Allow</p>
<pre><code>&lt;Directory &quot;/app/testweb&quot;&gt;
    Options Indexes
    Order allow,deny
    Allow from 192.168
&lt;/Directory&gt;
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160628.jpg" alt=""></p>
<p>（10）日志设定</p>
<p>LogLevel 设定日志级别</p>
<p>LogFormat   定义日志格式</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>LogFormat “%h %l %u %t \”%r\” %&gt;s %b \”%{Referer}i\” \”%{User-Agent}i\”” combined</p>
<p>Syntax:    CustomLog file|pipe format|nickname [env=[!]environment-variable</p>
<blockquote>
<p>示例</p>
</blockquote>
<p>CustomLog logs/access_log combined</p>
<pre><code>/var/log/error_log 错误日志存放位置
/var/log/access_log 访问成功日志存放位置
</code></pre><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%h</td>
<td>客户端IP地址</td>
</tr>
<tr>
<td>%L</td>
<td>远程用户，启动<code>mod_ident</code>才有效，通常为“-”</td>
</tr>
<tr>
<td>%u</td>
<td>验证远程用户，非登录访问时，为一个“-”</td>
</tr>
<tr>
<td>%t</td>
<td>服务器收到请求时的时间</td>
</tr>
<tr>
<td>%r</td>
<td>表示请求报文的首行，记录了此次请求的方法、URL以及协议版本</td>
</tr>
<tr>
<td>%&gt;s</td>
<td>响应状态码</td>
</tr>
<tr>
<td>%b</td>
<td>响应报文的大小，单位为字节；不包括响应报文http首部</td>
</tr>
<tr>
<td>%{Referer}i</td>
<td>请求报文中首部“referer”的值，即从哪个页面中的超链接跳转至当前页面</td>
</tr>
<tr>
<td>%{User-Agent}i</td>
<td>请求报文中首部“User-Agent”的值，即发出请求的应用程序</td>
</tr>
</tbody>
</table>
<p><strong>示例：</strong></p>
<p>192.168.4.1 - - [18/Sep/2017:17:14:09 +0800] “GET / HTTP/1.1” 403 281 “-“ “Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0”</p>
<p>（11）AddDefaultCharset 设定默认字符集</p>
<p>Syntax:    AddCharset charset extension [extension] …</p>
<p>常用类型：UTF-8 GBK GB2312 GB18030</p>
<p>（12）定义路径别名</p>
<p>Syntax:    <code>Alias</code> URL-path file-path|directory-path</p>
<p>Syntax:    <code>AliasMatch</code> regex file-path|directory-path #可以使用通配符和正则表达式</p>
<p><strong>示例:</strong></p>
<p>修改<code>custom.conf</code>文件</p>
<pre><code>Alias /test /app/testweb
&lt;Directory &quot;/app/testweb&quot;&gt;
    Options Indexes
&lt;/Directory&gt;
</code></pre><p>重启服务测试</p>
<p><code>[root@localhost testweb]# curl -I 192.168.4.132/test</code></p>
<pre><code>HTTP/1.1 301 Moved Permanently
Date: Mon, 18 Sep 2017 09:38:50 GMT
Server: Apache/2.2.15 (CentOS)
Location: http://192.168.4.132/test/
Connection: close
Content-Type: text/html; charset=iso-8859-1
</code></pre><p>（13）基于用户的访问控制</p>
<p>认证质询：WWW-Authenticate</p>
<p>Authorization：客户端用户填入账号和密码后再次发送请求报文；认证通过时，服务器发送响应的资源。</p>
<p>认证方式类型：</p>
<pre><code>basic：明文
digest：消息摘要认证，兼容性查
</code></pre><p>安全域：需要用户认证后才能访问的路径；通过名称对齐进行标识，以便于告知用户认证原因。</p>
<p>虚拟账户：仅用于访问某服务时用到的认证标识。创建文件的位置在<code>/etc/httpd/conf.d/</code>目录下。</p>
<blockquote>
<p>basic认证示例<br>（1）定义安全域</p>
</blockquote>
<pre><code>&lt;Directory “/PATH”&gt;
    AuthType #认证类型
    AuthName #提示信息
    AuthUserFile #认证文件位置
    Require user UserName1 UserName2 .. #从认证文件中挑选出的用户可以访问
    Requie vaild-user #允许账户文件中的所有用户登录访问
    AuthGroupFile  组文件存放的位置
    Require group GrpName1 GrpName1.. #允许指定组用户登录访问
&lt;/Directory&gt;
</code></pre><p>（2）提供账号和密码存储的位置，一般为隐藏文件</p>
<h5 id="htpasswd命令"><a href="#htpasswd命令" class="headerlink" title="htpasswd命令"></a>htpasswd命令</h5><p>htpasswd ：Manage user files for basic authentication</p>
<p>选项：</p>
<pre><code>-c：自动创建文件，仅在文件不存在创建时使用
-m：使用md5加密
-s：使用sha格式加密
-D：删除指定用户
</code></pre><p>（3）创建组账号文件</p>
<pre><code>组名称：user1  user2 ...
</code></pre><h5 id="远程客户端和用户验证的控制"><a href="#远程客户端和用户验证的控制" class="headerlink" title="远程客户端和用户验证的控制"></a>远程客户端和用户验证的控制</h5><p>Satisfy： Interaction between host-level access control and user authentication 主机访问控制和用户认证之间的交互</p>
<p>|<br>|All|客户机IP和用户验证都需要通过才能访问<br>|Any|客户机IP和用户验证有一个满足就可以访问</p>
<blockquote>
<p>示例一</p>
</blockquote>
<p>基于用户认证控制</p>
<p>（1）创建存放密码的配置文件</p>
<p><code>[root@localhost conf.d]# htpasswd -c .htusers wang</code><br><code>[root@localhost conf.d]# htpasswd -s .htusers li</code><br><code>[root@localhost conf.d]# htpasswd -s .htusers joah</code></p>
<p>（2）修改<code>custom.conf</code>配置文件</p>
<pre><code>Alias /test /app/testweb
&lt;Directory &quot;/app/testweb&quot;&gt;
    Options Indexes
    AuthType basic
    AuthName &quot;welcom visit...&quot;
    AuthUserFile &quot;/etc/httpd/conf.d/.htusers&quot;
    Require user wang
&lt;/Directory&gt;
</code></pre><p>（3）重启服务测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_173622.jpg" alt=""></p>
<p>输入wang账户后</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160628.jpg" alt=""></p>
<blockquote>
<p>示例二</p>
</blockquote>
<p>基于组账户认证</p>
<p>在上述基础之上进行如下操作</p>
<p>（1）将上述用户加入组中<br><code>[root@localhost conf.d]# groupmems -a wang -g webtest</code></p>
<p><code>[root@localhost conf.d]# groupmems -a li -g webtest</code></p>
<p><code>[root@localhost conf.d]# groupmems -a joah -g webtest</code></p>
<p>（2）创建组用户文件</p>
<p><code>[root@localhost conf.d]# vim .htgrps</code></p>
<pre><code>webtest:wang li
</code></pre><p>（3）修改<code>custom.conf</code>文件<br>Alias /test /app/testweb</p>
<pre><code>&lt;Directory &quot;/app/testweb&quot;&gt;
    Options Indexes
    AuthType basic
    AuthName &quot;welcom visit...&quot;
    AuthUserFile &quot;/etc/httpd/conf.d/.htusers&quot;
    AuthGroupFile &quot;/etc/httpd/conf.d/.htgrps&quot;
    Require group webtest
&lt;/Directory&gt;
</code></pre><p>（4）重启服务测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_173622.jpg" alt=""></p>
<p>输入li账户后</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_160628.jpg" alt=""></p>
<p>（14）虚拟主机</p>
<p>虚拟主机有三种实现方式：</p>
<ul>
<li>基于IP，为每个虚拟主机准备至少一个IP地址</li>
<li>基于Port，为每个虚拟主机使用至少一个独立的Port</li>
<li>基于FQDN，为每个虚拟主机使用至少一个FQDN</li>
</ul>
<p><strong>注意：一般虚拟主机不要与Main主机混用；如果要使用虚拟主机，一般先禁用Main主机。<br>如果要禁用Main主机，直接禁用DocumentRoot即可。</strong></p>
<blockquote>
<p>示例一：基于IP的虚拟主机</p>
</blockquote>
<p>（1）编辑配置文件<code>custom.conf</code></p>
<pre><code>&lt;VirtualHost  192.168.4.132:80&gt;
    DocumentRoot &quot;/app/a.com/htdocs&quot;
&lt;/VirtualHost&gt;
&lt;VirtualHost  192.168.4.133:80&gt;
    DocumentRoot &quot;/app/b.net/htdocs&quot;
&lt;/VirtualHost&gt;
&lt;VirtualHost  192.168.4.134:80&gt;
    DocumentRoot &quot;/app/c.org/htdocs&quot;
&lt;/VirtualHost&gt;
</code></pre><p>（2）创建所需文件</p>
<p><code>[root@localhost conf.d]# mkdir /app/a.com/htdocs -pv</code></p>
<p><code>[root@localhost conf.d]# mkdir /app/b.net/htdocs -pv</code></p>
<p><code>[root@localhost conf.d]# mkdir /app/c.org/htdocs -pv</code></p>
<p><code>[root@localhost conf.d]# echo www.a.com &gt; /app/a.com/htdocs/index.html</code></p>
<p><code>[root@localhost conf.d]# echo www.b.net&gt; /app/b.net/htdocs/index.html</code></p>
<p><code>[root@localhost conf.d]# echo www.c.org&gt; /app/c.org/htdocs/index.html</code></p>
<p>（3）添加IP地址</p>
<p><code>[root@localhost conf.d]# ip addr add 192.168.4.133/24 dev eth0</code></p>
<p><code>[root@localhost conf.d]# ip addr add 192.168.4.134/24 dev eth0</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_185150.jpg" alt=""></p>
<p>（4）重启服务测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_185248.jpg" alt=""></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_185306.jpg" alt=""></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-29_185320.jpg" alt=""></p>
<blockquote>
<p>示例二：基于Port的虚拟主机</p>
</blockquote>
<p>（1）编辑<code>custom.com</code>文件</p>
<pre><code>Listen 192.168.4.132:81
Listen 192.168.4.132:82
Listen 192.168.4.132:83

&lt;VirtualHost  192.168.4.132:80&gt;
    DocumentRoot &quot;/app/a.com/htdocs&quot;
&lt;/VirtualHost&gt;
&lt;VirtualHost  192.168.4.132:81&gt;
    DocumentRoot &quot;/app/b.net/htdocs&quot;
&lt;/VirtualHost&gt;
&lt;VirtualHost  192.168.4.132:82&gt;
    DocumentRoot &quot;/app/c.org/htdocs&quot;
&lt;/VirtualHost&gt;
</code></pre><p>（2）重启服务器测试</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-30_135922.jpg" alt=""></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-30_135935.jpg" alt=""></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-30_135949.jpg" alt=""></p>
<blockquote>
<p>示例三：基于FQDN的虚拟主机</p>
</blockquote>
<p>我们准备三台虚拟主机，一台CentOS 6 配置3个FQDN，一台CentOS 7配置DNS，一台CentOS 7测试</p>
<p>第一步：在CentOS 6 上配置3个FQDN</p>
<pre><code>NameVirtualHost *:80    #注意这项配置在CentOS 6 中必须开启，切记！！！
NameVirtualHost *:80
&lt;VirtualHost *:80&gt;
    ServerName &quot;www.a.com&quot;
    DocumentRoot &quot;/app/a.com&quot;
&lt;/VirtualHost&gt;
&lt;VirtualHost *:80&gt;
    ServerName &quot;www.b.com&quot;
    DocumentRoot &quot;/app/b.com&quot;
&lt;/VirtualHost&gt;
&lt;VirtualHost *:80&gt;
    ServerName &quot;www.c.com&quot;
    DocumentRoot &quot;/app/c.com&quot;
&lt;/VirtualHost&gt;
</code></pre><p>第二步：在CentOS 7上配置DNS服务器 </p>
<p><code>[root@localhost~]#yum install -y bind</code></p>
<p><code>[root@localhost/etc/named]#vim /etc/named.conf</code>    #修改图中方框内容</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-01_101243.jpg" alt=""></p>
<p><code>[root@localhost/etc/named]#vim /etc/named.rfc1912.zones</code><br><img src="http://owatlfstl.bkt.clouddn.com/2017-10-01_101804.jpg" alt=""></p>
<p><code>[root@localhost/var/named]#vim a.com.zone</code>    #b.com.zone 和c.com.zone类似这里就不累述。</p>
<pre><code>  1 $TTL 1D
  2 @       IN SOA  dns1 mail.a.com. (
  3                                         0       ; serial
  4                                         1D      ; refresh
  5                                         1H      ; retry
  6                                         1W      ; expire
  7                                         3H )    ; minimum
  8         NS      dns1
  9 dns1    A       192.168.4.164
 10 www     A       192.168.4.132
</code></pre><p>重启服务</p>
<p>第三步：在另一台CentOS 7 主机上测试</p>
<p><code>[root@localhost~]#vim /etc/resolv.conf</code>    #修改DNS</p>
<pre><code>  1 # Generated by NetworkManager
  2 search localdomain
  3 nameserver 192.168.4.164
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-01_115724.jpg" alt=""></p>
<p>（15）status页面</p>
<p>要实现这个功能需要加载模块<code>mod_status.so</code></p>
<p>格式：</p>
<pre><code>LoadModule  status_module  modules/mod_status.so

&lt;Location /server-status&gt;
    SetHandler server-status
    Order allow,deny
    Allow   192.168.4
&lt;/Location&gt;
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-01_120206.jpg" alt=""></p>
<pre><code>ExtendedStatus On   #开启此选项显示更多内容
</code></pre><p><strong>建议：不要开启此选项，如果处于测试状态可以开启拍错。</strong></p>
<p>（16）mod_deflate模块 压缩页面优化传输速度</p>
<p>适用场景：</p>
<ul>
<li>节约带宽，额外消耗CPU；</li>
<li>压缩适于压缩的资源，如文本文件</li>
</ul>
<p>如何启用压缩功能？</p>
<p>SetOutputFilter DEFLATE</p>
<pre><code>AddOutputFilterByType DEFLATE text/plain AddOutputFilterByType DEFLATE text/html AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE text/xml AddOutputFilterByType DEFLATE application/xml AddOutputFilterByTypeDEFLATE application/x-javascript 
AddOutputFilterByType DEFLATE text/javascript AddOutputFilterByType DEFLATE text/css 
</code></pre><p>Level of compression    指定压缩比 （1-9），默认为9</p>
<p>（17）mod_ssl模块 认证模块</p>
<p>http基于ssl认证过程：</p>
<pre><code>（1）客户端发送可供选择的加密方式，并向服务器请求证书
（2）服务器端发送证书以及选定的加密方式给客户端
（3）客户端取得证书并进行证书验证如果信任给其发证书的CA
    验证证书的来源的合法性：用CA的公钥解密证书上数字签名
    验证证书内容的合法性：完整性验证
    验证证书有效期限
    检查证书是否被吊销
（4）客户端生成临时会话密钥，并使用服务器端的公钥加密此数据发送给服务器，完成密钥交换
（5）服务用此密钥加密用户请求的资源，响应客户端。
</code></pre><p><strong>注意：SSL是基于IP地址实现，单IP的主机仅可以使用一个HTTPS虚拟主机。</strong></p>
<blockquote>
<p>实现https的过程：</p>
</blockquote>
<p>（1）先建立私有CA；在CentOS 7上</p>
<p><code>[root@localhost~]#cd /etc/pki/CA/</code></p>
<p><code>[root@localhost/etc/pki/CA]#(umask 066；openssl genrsa -out private/cakey.pem 2048</code>）</p>
<p><code>[root@localhost/etc/pki/CA]#openssl req -new -x509 -key private/cakey.pem -out casert.pem -days 4650</code></p>
<p><code>[root@localhost/etc/pki/CA]#echo 01 &gt; serial</code></p>
<p><code>[root@localhost/etc/pki/CA]#touch index.txt</code></p>
<p>（2）在CentOS 6上创建请求认证证书</p>
<p><code>[root@localhost ssl]# (umask 066；openssl genrsa -out httpd.key 2048）</code></p>
<p><code>[root@localhost ssl]# openssl req -new -key httpd.key -out httpd.csr</code></p>
<p><code>[root@localhost ssl]# scp httpd.csr 192.168.4.163:/etc/pki/CA/certs/</code></p>
<p>（3）CentOS 7对收到的证书签证并返回</p>
<p><code>[root@localhost/etc/pki/CA/certs]#openssl ca -in httpd.csr -out httpd.crt -days 300</code></p>
<p><code>[root@localhost/etc/pki/CA/certs]#scp httpd.crt 192.168.4.132:/etc/httpd/conf/ssl</code></p>
<p>（4）在CentOS 6上安装此 模块并修改配置文件</p>
<p><code>[root@localhost conf.d]# yum install -y mod_ssl</code></p>
<p><code>[root@localhost conf.d]# vim ssl.conf</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-09-30_083150.jpg" alt=""><br><img src="http://owatlfstl.bkt.clouddn.com/2017-09-30_074017.jpg" alt=""></p>
<p>（5）将证书拷贝到本地添加至浏览器中</p>
<p>当我们每次输入<a href="http://192.168.4.132时想要直接https://192.168.4.132访问网页怎么做呢？" target="_blank" rel="noopener">http://192.168.4.132时想要直接https://192.168.4.132访问网页怎么做呢？</a></p>
<p>将http请求转发至https的URL，可以使用重定向</p>
<pre><code>Redirect [status] URL-path URL
</code></pre><blockquote>
<p>status分类：</p>
</blockquote>
<ul>
<li>Permanent:Returns a permanent redirect status(301)    indicating that the resource has moved permanently</li>
<li>Temp:Returns a temporary redirect status (302). This is the default</li>
</ul>
<blockquote>
<p>示例：</p>
</blockquote>
<pre><code>Redirect temp  / https://www.a.com/
Redirect permanent / https://www.a.com/
</code></pre><p><strong>注意：设置跳转时，根下的目录也会自动跳转。</strong></p>
<p><code>[root@localhost conf.d]# vim custom.conf</code></p>
<pre><code>Redirect temp / https://192.168.4.132/
</code></pre><p>测试</p>
<p><code>[root@localhost conf.d]# curl --cacert -L 192.168.4.132/</code></p>
<pre><code>&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;302 Found&lt;/title&gt;    #由于之前我们已经介绍了状态码，所以看到302代表临时跳转。
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Found&lt;/h1&gt;
&lt;p&gt;The document has moved &lt;a href=&quot;https://192.168.4.132/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.2.15 (CentOS) Server at 192.168.4.132 Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre><p>（18）HSTS:HTTP Strict Transport Security</p>
<p>如果我们使用HTTPS 访问一个网站，我们大多数情况习惯按<code>http://</code>这样的方式去访问，在配置文件中添加<code>Redirect temp / https://</code> 或<code>Redirect permanent / https://</code>这种方式解决；其工作方式如下</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/%E9%87%8D%E5%AE%9A%E5%90%91.png" alt=""></p>
<p>当浏览器第一次发出HTTP请求时是明文发送的，这种容易被攻击者拦截下来，攻击者作为代理，把当前请求转发至钓鱼网站，钓鱼网站返回假冒的网页内容，攻击者把假冒的网页返回给浏览器；如下图</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/%E9%87%8D%E5%AE%9A%E5%90%91%E6%94%BB%E5%87%BB%E8%80%85.png" alt=""></p>
<p>为了解决这个文件就有人提出了HSTS方案：服务器端配置支持HSTS后，会在给浏览器返回的HTTP首部中携带HSTS字段。浏览器获取到该信息后，会将所有HTTP访问请求在内部做307跳转到HTTPS，而无需任何网络过程；从而使得中间人攻击失效。<br><img src="http://owatlfstl.bkt.clouddn.com/hsts1.png" alt=""></p>
<blockquote>
<p>如何设置HSTS呢？</p>
</blockquote>
<p>Strict-Transport-Security: <max-age=>[; includeSubDomains][; preload]</max-age=></p>
<pre><code>max-age：过期时间，默认单位为秒，你每次访问它都会在访问时间之后的值时间。
includeSubDomains：是可选参数，如果包含它意味着当前域名或子域均开启HSTS保护
preload：是可选参数，只有当你申请将自己的加入到浏览器内置列表的时候才需要使用到它。
</code></pre><blockquote>
<p>重定向的另外一种方式：使用模块mod_rewrite</p>
</blockquote>
<p>在使用这种方式之前我们先确认<code>mod_rewrite</code>是否被加载</p>
<p>格式：</p>
<p><img src="http://owatlfstl.bkt.clouddn.com/syntax_rewritecond.png" alt=""></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/syntax_rewriterule.png" alt=""></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/rewrite_backreferences.png" alt=""></p>
<p><strong>示例:</strong></p>
<pre><code>Header always set Strict-Transport-Security &quot;max-age=15768000&quot;
RewriteEngine on    #是否开启重启引擎
RewriteRule ^(/.*)$    https://%{HTTP_HOST}$1 [redirect=301] 
</code></pre><p>（19）httpd自带的工具程序</p>
<ul>
<li>ab命令：压力测试工具</li>
</ul>
<p>usage：ab  [OPTIONS]  URL</p>
<pre><code>-n：总请求数
-c：模拟的并行数
-k：以持久连接模式测试
</code></pre><ul>
<li>htpasswd：基于认证basci时，用到的账户密码文件生成工具</li>
</ul>
<p>usage： htpasswd [ -c ] [ -m ] [ -D ] passwdfile username</p>
<pre><code>-c：如果passwdfile文件不存在使用
-D：删除用户
-m：使用md5加密，默认
-s：使用SHA格式加密
</code></pre><h2 id="三、编译安装httpd-2-4"><a href="#三、编译安装httpd-2-4" class="headerlink" title="三、编译安装httpd-2.4"></a>三、编译安装httpd-2.4</h2><p>（1）准备安装前环境</p>
<p><code>[root@localhost ~]# yum groupinstall -y &quot;development tools&quot;</code></p>
<p>（2）编译安装apr</p>
<p><code>[root@localhost src]# tar xf apr-1.6.2.tar.gz</code><br><code>[root@localhost apr-1.6.2]# ./configure --prefix=/app/apr</code><br><code>[root@localhost apr-1.6.2]# make &amp;&amp; make install</code></p>
<p>（3）编译安装apr-util</p>
<p><code>[root@localhost src]# tar xf apr-util-1.6.0.tar.gz</code><br><code>[root@localhost apr-util-1.6.0]# ./configure --prefix=/app/apr-util --with-apr=/app/apr</code><br><code>[root@localhost apr-util-1.6.0]# yum install -y expat-devel</code>   #编译依赖与这个包（Expat是一个用C语言开发的、用来解析XML文档的开发库）<br><code>[root@localhost apr-util-1.6.0]# make &amp;&amp; make install</code></p>
<p>（4）编译安装httpd-2.4<br><code>[root@localhost src]# useradd -r -m -d /app/website -s /sbin/nologin apache</code></p>
<p><code>[root@localhost src]# tar xf httpd-2.4.27.tar.bz2</code></p>
<p><code>[root@localhost httpd-2.4.27]# yum install -y pcre-devel openssl-devel</code></p>
<p><code>[root@localhost httpd-2.4.27]# ./configure --prefix=/app/httpd24 --enable-so --enable-ssl --enable-cgi --enable-rewrite --with-zlib --with-pcre --with-apr=/app/apr/ --with-apr-util=/app/apr-util/ --enable-modules=most --enable-mpms-shared=all --with-mpm=prefork</code></p>
<p><code>[root@localhost bin]# make &amp;&amp; make install</code></p>
<blockquote>
<p>修改PATH路径</p>
</blockquote>
<p><code>[root@localhost bin]# vim /etc/profile.d/http24.sh</code></p>
<pre><code>export PATH=/app/httpd24/bin:$PATH
</code></pre><p><code>[root@localhost bin]# source /etc/profile.d/http24.sh</code>    #使其生效<br><code>[root@localhost bin]# echo $PATH</code></p>
<pre><code>/app/httpd24/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
</code></pre><blockquote>
<p>修改配置文件</p>
</blockquote>
<p><code>[root@localhost conf]# vim httpd.conf</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_181833.jpg" alt=""><br><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_182033.jpg" alt=""></p>
<blockquote>
<p>配置启动脚本</p>
</blockquote>
<p>方法一：</p>
<p><code>[root@localhost conf]# scp 192.168.4.132:/etc/init.d/httpd /etc/init.d/httpd24</code>  #如果其他主机上有可以拷贝一份</p>
<p><code>[root@localhost httpd-2.4.27]# vim /etc/init.d/httpd24</code></p>
<pre><code>apachectl=/app/httpd24/apachectl
httpd=${HTTPD-/app/httpd24/httpd}
prog=httpd
pidfile=${PIDFILE-/app/httpd24/logs/httpd.pid}
lockfile=${LOCKFILE-/var/lock/subsys/httpd}
RETVAL=0
STOP_TIMEOUT=${STOP_TIMEOUT-10}
</code></pre><p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_211234.jpg" alt=""></p>
<p><code>[root@localhost conf]# chkconfig --add httpd24</code>    #将此服务加到服务中心<br><code>[root@localhost conf]# chkconfig httpd24 on</code>设为开机启动</p>
<p>方法二：由于CentOS 6中支持rc.local脚本所有我们可以把命令写到脚本中，设为开机启动</p>
<p><code>[root@localhost conf]# vim /etc/rc.d/rc.local</code></p>
<pre><code>/app/httpd24/apachectl start
</code></pre><p><code>[root@localhost conf]# chmod +x /etc/rc.d/rc.local</code></p>
<blockquote>
<p>测试</p>
</blockquote>
<p><code>[root@localhost website]# echo index.html &gt; index.html</code></p>
<p><code>[root@localhost website]# apachectl start</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_183544.jpg" alt=""></p>
<blockquote>
<p>安装方式二</p>
</blockquote>
<p>（1）准备安装前环境</p>
<p><code>[root@localhost ~]# yum groupinstall -y &quot;development tools&quot;</code></p>
<p>（2）解压apr包</p>
<p><code>[root@localhost src]# tar xf apr-1.6.2.tar.gz</code> </p>
<p>（3）解压apr-util包</p>
<p><code>[root@localhost src]# tar xf apr-util-1.6.0.tar.gz</code> </p>
<p>（4）编译安装httpd-2.4<br><code>[root@localhost src]# useradd -r -m -d /app/website -s /sbin/nologin apache</code></p>
<p><code>[root@localhost src]# tar xf httpd-2.4.27.tar.bz2</code></p>
<p><code>[root@localhost httpd-2.4.27]# yum install -y pcre-devel openssl-devel</code></p>
<blockquote>
<p>将解压包移动到srclib目录下<br><code>[root@localhost src]# mv apr-1.6.2 httpd-2.4.27/srclib/apr</code> </p>
</blockquote>
<p><code>[root@localhost src]# mv apr-util-1.6.0 httpd-2.4.27/srclib/apr-util</code></p>
<p><code>[root@localhost httpd-2.4.27]# ./configure --prefix=/app/httpd24 --enable-so --enable-ssl --enable-cgi --enable-rewrite --with-zlib --with-pcre --with-included-apr --enable-modules=most --enable-mpms-shared=all --with-mpm=prefork</code></p>
<p><code>[root@localhost httpd-2.4.27]# make &amp;&amp; make install</code></p>
<blockquote>
<p>修改配置文件</p>
</blockquote>
<p><code>[root@localhost conf]# vim httpd.conf</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_181833.jpg" alt=""><br><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_182033.jpg" alt=""></p>
<blockquote>
<p>配置启动脚本</p>
</blockquote>
<p>方法一：</p>
<p><code>[root@localhost conf]# scp 192.168.4.132:/etc/init.d/httpd /etc/init.d/httpd24</code>  #如果其他主机上有可以拷贝一份</p>
<p><code>[root@localhost httpd-2.4.27]# vim /etc/init.d/httpd24</code></p>
<pre><code>apachectl=/app/httpd24/apachectl
httpd=${HTTPD-/app/httpd24/httpd}
prog=httpd
pidfile=${PIDFILE-/app/httpd24/logs/httpd.pid}
lockfile=${LOCKFILE-/var/lock/subsys/httpd}
RETVAL=0
STOP_TIMEOUT=${STOP_TIMEOUT-10}
</code></pre><p><code>[root@localhost conf]# chkconfig --add httpd24</code>    #将此服务加到服务中心<br><code>[root@localhost conf]# chkconfig httpd24 on</code>设为开机启动</p>
<p>方法二：由于CentOS 6中支持rc.local脚本所有我们可以把命令写到脚本中，设为开机启动</p>
<p><code>[root@localhost conf]# vim /etc/rc.d/rc.local</code></p>
<pre><code>/app/httpd24/apachectl start
</code></pre><p><code>[root@localhost conf]# chmod +x /etc/rc.d/rc.local</code></p>
<p>方法三：将/app/httpd24/bin/apachectl文件拷贝至/etc/init.d/httpd</p>
<p><code>[root@localhost httpd24]# cp /app/httpd24/bin/apachectl /etc/init.d/httpd24</code></p>
<blockquote>
<p>测试</p>
</blockquote>
<p><code>[root@localhost website]# echo index.html &gt; index.html</code></p>
<p><code>[root@localhost website]# apachectl start</code></p>
<p><img src="http://owatlfstl.bkt.clouddn.com/2017-10-02_183544.jpg" alt=""></p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="www.lmfe.org" class="b-link-green">Joah</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2017/11/28/HTTP安装及配置文件介绍/" class="b-link-green">HTTP配置</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2017/11/28/tcpdump简单介绍/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="tcpdump">
                        
                        <span class="card-title">tcpdump</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">tcpdump是一个运行在命令行下的嗅探工具，它允许用户拦截和显示发送或收到过网络连接到该计算机的TCP/IP和其他数据包。在linux中需要使用libpcap捕捉数据的库。
1、tcpdump命令SYNOPSIS
   tcpdump [</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2017-11-28
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/命令/" class="post-category" target="_blank">
                                    命令
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/tcpdump/" target="_blank">
                        <span class="chip bg-color">tcpdump</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2017/11/28/keepalived/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="keepalived简单介绍">
                        
                        <span class="card-title">keepalived简单介绍</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">keepalived介绍keepalived是linux下一个轻量级高可用的解决方案，主要通过VRRP实现高可用功能，作用域网络层、传输层和应用层；主要用作RealServer的健康性检查以及LoadBalance主机和Bcakup主机之间</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2017-11-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/常用服务/" class="post-category" target="_blank">
                                    常用服务
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Keepalived/" target="_blank">
                        <span class="chip bg-color">Keepalived</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">180.3k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ergedan/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:473823554@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=473823554" class="tooltipped" data-tooltip="QQ联系我: 473823554" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input" autofocus="">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->




    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>